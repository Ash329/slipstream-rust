name: Build Release
on: workflow_dispatch

jobs:
  build-linux:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          submodules: recursive
      
      - name: Install Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential cmake pkg-config libssl-dev
      
      - name: Install Rust
        uses: dtolnay/rust-toolchain@stable
      
      - name: Build slipstream-client
        env:
          PICOQUIC_AUTO_BUILD: 1
        run: cargo build -p slipstream-client --release
      
      - name: Build slipstream-server
        env:
          PICOQUIC_AUTO_BUILD: 1
        run: cargo build -p slipstream-server --release
      
      - name: Upload Client Binary
        uses: actions/upload-artifact@v4
        with:
          name: slipstream-client-linux
          path: target/release/slipstream-client
      
      - name: Upload Server Binary
        uses: actions/upload-artifact@v4
        with:
          name: slipstream-server-linux
          path: target/release/slipstream-server
